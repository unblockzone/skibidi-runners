<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skibidi Runners</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }

        /* Loading Screen */
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: Arial, sans-serif;
            z-index: 1;
        }
        #loading-bar {
            width: 80%;
            background-color: #555;
            height: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        #loading-progress {
            height: 100%;
            background-color: #00ff00;
            border-radius: 10px;
            width: 0%;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div id="loading-text">Skibidi Runners</div>
        <div id="loading-bar">
            <div id="loading-progress"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Game Variables
        let scene, camera, renderer;
        let player, speed, score, jumpVelocity, isJumping, gameOver;
        let coins, toilets, snowflakes;
        let lanes, currentLaneIndex;
        let keys;
        let loadingProgress, loadingText, loadingProgressElement;
        let gradientShift;

        // Initialize the game
        function init() {
            // Scene, Camera, Renderer
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 10, 5);
            scene.add(light);

            // Road (Three lanes)
            const roadGeometry = new THREE.PlaneGeometry(12, 1000);
            const roadMaterial = new THREE.MeshLambertMaterial({ color: 0x808080 });
            const road = new THREE.Mesh(roadGeometry, roadMaterial);
            road.rotation.x = -Math.PI / 2;
            scene.add(road);

            // Player (Running Animation Simulation)
            const playerGeometry = new THREE.CylinderGeometry(0.5, 0.5, 2, 32);
            const playerMaterial = new THREE.MeshLambertMaterial({ color: 0x0000ff });
            player = new THREE.Mesh(playerGeometry, playerMaterial);
            player.position.y = 1;
            scene.add(player);

            // Initialize game variables
            coins = [];
            toilets = [];
            snowflakes = [];
            lanes = [-4, 0, 4];
            currentLaneIndex = 1; // Start in the middle lane
            speed = 0.2;
            score = 0;
            isJumping = false;
            jumpVelocity = 0;
            gameOver = false;

            // Controls
            keys = {};
            window.addEventListener("keydown", (event) => {
                keys[event.key] = true;
            });
            window.addEventListener("keyup", (event) => {
                keys[event.key] = false;
            });

            // Game loop
            gameLoop();
        }

        // Loading progress and setup
        loadingProgress = 0;
        loadingText = document.getElementById("loading-text");
        loadingProgressElement = document.getElementById("loading-progress");

        // Loading screen loop
        const loadGame = () => {
            if (loadingProgress < 100) {
                loadingProgress += 0.5;
                loadingProgressElement.style.width = loadingProgress + "%";
                requestAnimationFrame(loadGame);
            } else {
                document.getElementById("loading-screen").style.display = "none";
                init();
            }
        };

        // Restart the game
        function restartGame() {
            // Clear existing objects and reset variables
            scene.clear();

            // Reset game state
            player.position.set(0, 1, 0);
            speed = 0.2;
            score = 0;
            isJumping = false;
            jumpVelocity = 0;
            gameOver = false;

            // Reset coins, toilets, and snowflakes
            coins.forEach(coin => scene.remove(coin));
            toilets.forEach(toilet => scene.remove(toilet));
            snowflakes.forEach(snowflake => scene.remove(snowflake));

            coins = [];
            toilets = [];
            snowflakes = [];

            // Restart the game loop
            gameLoop();
        }

        // Game Loop
        function gameLoop() {
            requestAnimationFrame(gameLoop);

            if (gameOver) {
                setTimeout(() => {
                    restartGame();
                }, 2000); // Restart after a short delay
                return;
            }

            // Jump logic
            if (isJumping) {
                player.position.y += jumpVelocity;
                jumpVelocity -= 0.01;
                if (player.position.y <= 1) {
                    player.position.y = 1;
                    isJumping = false;
                }
            }

            // Move road, coins, obstacles
            const road = scene.children.find(child => child instanceof THREE.Mesh && child.geometry.type === 'PlaneGeometry');
            road.position.z += speed;

            coins.forEach((coin, index) => {
                coin.position.z += speed;
                coin.rotation.y += 0.1; // Spinning effect
                if (coin.position.z > 10) {
                    scene.remove(coin);
                    coins.splice(index, 1);
                }
            });

            snowflakes.forEach((snowflake) => {
                snowflake.position.y -= 0.05;
                if (snowflake.position.y < -10) {
                    snowflake.position.y = Math.random() * 20 + 10;
                }
            });

            toilets.forEach((toilet, index) => {
                toilet.position.z += speed;
                if (toilet.position.z > 10) {
                    scene.remove(toilet);
                    toilets.splice(index, 1);
                }

                // Check for collision
                if (
                    Math.abs(player.position.x - toilet.position.x) < 0.5 &&
                    Math.abs(player.position.z - toilet.position.z) < 0.5 &&
                    Math.abs(player.position.y - toilet.position.y) < 1
                ) {
                    gameOver = true;
                    loadingText.textContent = `Game Over! Final Score: ${score}`;
                }
            });

            // Spawn coins, toilets, and snowflakes
            if (Math.random() < 0.02) createCoin();
            if (Math.random() < 0.02) createToilet();
            if (Math.random() < 0.05) createSnowflake();

            // Speed increase
            speed += 0.0001;

            // Arrow Key Movement
            if (keys["ArrowLeft"] && currentLaneIndex > 0) {
                player.position.x = lanes[--currentLaneIndex];
            }
            if (keys["ArrowRight"] && currentLaneIndex < lanes.length - 1) {
                player.position.x = lanes[++currentLaneIndex];
            }
            if (keys["ArrowUp"] && !isJumping) {
                isJumping = true;
                jumpVelocity = 0.3;
            }

            // Camera follow player
            camera.position.set(player.position.x, player.position.y + 5, player.position.z + 10);
            camera.lookAt(player.position);

            // Render the scene
            renderer.render(scene, camera);
        }

        // Create a coin
        function createCoin() {
            const coinGeometry = new THREE.TorusGeometry(0.3, 0.1, 16, 100);
            const coinMaterial = new THREE.MeshLambertMaterial({ color: 0xffff00 });
            const coin = new THREE.Mesh(coinGeometry, coinMaterial);
            coin.rotation.x = Math.PI / 2;
            coin.position.set(Math.random() * 10 - 5, 1.5, -50);
            scene.add(coin);
            coins.push(coin);
        }

        // Create a toilet (obstacle)
        function createToilet() {
            const toiletGeometry = new THREE.CylinderGeometry(0.5, 0.5, 2, 32);
            const toiletMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const toilet = new THREE.Mesh(toiletGeometry, toiletMaterial);
            toilet.position.set(Math.random() * 8 - 4, 1, -50);
            scene.add(toilet);
            toilets.push(toilet);
        }

        // Create a snowflake
        function createSnowflake() {
            const snowflakeGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const snowflakeMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const snowflake = new THREE.Mesh(snowflakeGeometry, snowflakeMaterial);
            snowflake.position.set(Math.random() * 20 - 10, Math.random() * 20 + 10, Math.random() * 20 - 10);
            scene.add(snowflake);
            snowflakes.push(snowflake);
        }

        // Start loading the game
        loadGame();
    </script>
</body>
</html>
